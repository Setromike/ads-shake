<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sadə Konfet Çarxı</title>
  <style>
    body {
      margin: 0;
      background: url('https://i.postimg.cc/zXQKcM8H/candy-pastel-color-pattern-design-23-2150627546.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Comic Sans MS', cursive;
      text-align: center;
      color: #ff69b4;
    }
    .btn {
      background: #fff0f5;
      color: #ff1493;
      padding: 12px 20px;
      border-radius: 20px;
      border: 2px solid #ff69b4;
      box-shadow: 0 0 10px #ff69b4;
      font-weight: bold;
      margin: 10px;
      cursor: pointer;
    }
    #wheelContainer {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 20px auto;
    }
    #wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      transition: transform 4s ease-out;
    }
    #arrow {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 40px solid red;
      position: absolute;
      top: -40px;
      left: calc(50% - 20px);
      z-index: 10;
    }
    #withdrawPopup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,240,245,0.95);
      border: 2px solid #ff69b4;
      border-radius: 20px;
      padding: 20px;
      display: none;
      z-index: 1000;
    }
    input[type=text] {
      padding: 8px;
      width: 80%;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h2>Sadə Konfet Çarxı</h2>
  <div id="wheelContainer">
    <div id="arrow"></div>
    <canvas id="wheel" width="300" height="300"></canvas>
  </div>
  <p id="spinCounter">0/50</p>
  <button class="btn" onclick="showAdAndSpin()">Çarxı Fırlat</button>
  <button class="btn" onclick="showWithdraw()">Çıxarış</button>
  <button class="btn" onclick="showBalance()">Balans</button>

  <div id="withdrawPopup">
    <p>Çıxarış üçün yöntəm yazıb göndərin, yoxlanıldıqdan sonra təsdiqlənəcəkdir.</p>
    <input type="text" id="withdrawMethod" placeholder="Çıxarış yöntəmini yazın" />
    <br>
    <button class="btn" onclick="submitWithdraw()">GÖNDƏR</button>
    <button class="btn" onclick="document.getElementById('withdrawPopup').style.display='none'">Bağla</button>
  </div>

  <script src='//libtl.com/sdk.js' data-zone='9532911' data-sdk='show_9532911'></script>
  <script>
    const wheelCanvas = document.getElementById("wheel");
    const ctx = wheelCanvas.getContext("2d");
    const prizes = [0.1, 0.0008, 0.0005, 0.03, 0.00000001, 0.04, 0.2];
    const colors = ["#f9c", "#fc9", "#9cf", "#cfc", "#ccf", "#ffc", "#f99"];
    const angleStep = (2 * Math.PI) / prizes.length;

    let spinCount = parseInt(localStorage.getItem('spinCount') || '0');
    let lastReset = parseInt(localStorage.getItem('lastReset') || '0');
    let balance = parseFloat(localStorage.getItem('balance') || '0');

    function drawWheel() {
      ctx.clearRect(0, 0, 300, 300);
      for (let i = 0; i < prizes.length; i++) {
        ctx.beginPath();
        ctx.moveTo(150, 150);
        ctx.fillStyle = colors[i % colors.length];
        ctx.arc(150, 150, 150, i * angleStep, (i + 1) * angleStep);
        ctx.fill();
        ctx.save();
        ctx.translate(150, 150);
        ctx.rotate(i * angleStep + angleStep / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#000";
        ctx.font = "bold 14px Arial";
        ctx.fillText(`${prizes[i]} AZN`, 140, 5);
        ctx.restore();
      }
    }
    drawWheel();
    updateSpinText();

    function updateSpinText() {
      document.getElementById("spinCounter").innerText = `${spinCount}/50`;
    }

    function resetSpinIfNeeded() {
      const now = Date.now();
      if (now - lastReset > 24 * 60 * 60 * 1000) {
        spinCount = 0;
        lastReset = now;
        localStorage.setItem('spinCount', '0');
        localStorage.setItem('lastReset', `${now}`);
        updateSpinText();
      }
    }

    function showAdAndSpin() {
      resetSpinIfNeeded();
      if (spinCount >= 50) {
        alert("Günlük limit dolub. Zəhmət olmasa 24 saat sonra yenidən yoxlayın.");
        return;
      }
      show_9532911().then(() => {
        spinWheel();
      });
    }

    function spinWheel() {
      const index = Math.floor(Math.random() * prizes.length);
      const angle = 360 * 5 + (360 / prizes.length) * index;
      wheelCanvas.style.transition = "transform 4s ease-out";
      wheelCanvas.style.transform = `rotate(${angle}deg)`;

      setTimeout(() => {
        const reward = prizes[index];
        balance += reward;
        spinCount++;
        localStorage.setItem('balance', balance);
        localStorage.setItem('spinCount', spinCount);
        updateSpinText();
        alert(`${reward.toFixed(6)} AZN qazandınız!`);
      }, 4000);
    }

    function showWithdraw() {
      document.getElementById("withdrawPopup").style.display = "block";
    }

    function submitWithdraw() {
      const method = document.getElementById("withdrawMethod").value;
      if (!method) return alert("Zəhmət olmasa çıxarış yöntəmini daxil edin.");

      const tg = window.Telegram.WebApp.initDataUnsafe?.user;
      const msg = `✉️ Çıxarış sorğusu:%0AAd: ${tg?.first_name || 'Naməlum'}%0AID: ${tg?.id || 'Naməlum'}%0AYöntəm: ${method}%0AMəbləğ: ${balance.toFixed(2)} AZN`;

      fetch(`https://api.telegram.org/bot8133472449:AAHtl4g78JW2Jx5uw3Pxgn5TCXdVQTO9lMI/sendMessage?chat_id=8197921729&text=${msg}`)
        .then(res => res.json())
        .then(() => {
          alert("Çıxarış göndərildi!");
          balance = 0;
          localStorage.setItem('balance', '0');
          document.getElementById("withdrawPopup").style.display = "none";
        });
    }

    function showBalance() {
      alert(`Balans: ${balance.toFixed(5)} AZN`);
    }
  </script>
</body>
</html>
