<!DOCTYPE html><html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Şanslı Çarx</title>
  <style>
    body {
      margin: 0;
      background: url('https://i.postimg.cc/zXQKcM8H/candy-pastel-color-pattern-design-23-2150627546.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Comic Sans MS', cursive;
      text-align: center;
      color: #ff69b4;
    }
    .btn {
      background: #fff0f5;
      color: #ff1493;
      padding: 12px 20px;
      border-radius: 20px;
      border: 2px solid #ff69b4;
      box-shadow: 0 0 10px #ff69b4;
      font-weight: bold;
      margin: 10px;
      cursor: pointer;
    }
    #wheelContainer {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 20px auto;
    }
    #wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      transition: transform 4s ease-out;
    }
    #arrow {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 30px solid red;
      position: absolute;
      top: -30px;
      left: calc(50% - 20px);
      z-index: 10;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.2; }
    }
    #lights {
      position: absolute;
      top: 0;
      left: 0;
      width: 300px;
      height: 300px;
      pointer-events: none;
    }
    .light {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: yellow;
      position: absolute;
      animation: blink 1s infinite alternate;
      box-shadow: 0 0 10px yellow;
    }
    #popup, #invitePopup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #fff0f5;
      padding: 20px;
      border: 2px solid #ff69b4;
      border-radius: 20px;
      display: none;
      font-size: 18px;
      z-index: 1000;
      max-width: 90%;
    }
    #inviteList {
      margin-top: 10px;
      max-height: 100px;
      overflow-y: auto;
      font-size: 14px;
      text-align: left;
    }
  </style>
</head>
<body>
  <h2>\u015eansl\u0131 \u00c7arx</h2>
  <div id="wheelContainer">
    <canvas id="wheel" width="300" height="300"></canvas>
    <div id="arrow"></div>
    <div id="lights"></div>
  </div>
  <p id="spinCounter">0/50</p>
  <p>Bonus spin: <span id="bonusCount">0</span></p>
  <button class="btn" onclick="spinHandler()">Çarx Fırlat</button>
  <button class="btn" onclick="showInvitePopup()">Dəvət et</button>
  <button class="btn" onclick="showBalance()">Balans</button>
  <div id="popup"></div>
  <div id="invitePopup"></div>  <script src="//libtl.com/sdk.js" data-zone="9532911" data-sdk="show_9532911"></script>  <script>
    const prizes = [0.01, 0.05, 0.02, 0.1, 0.03, 0.005, 0.08, 0.06];
    const colors = ["#ffc0cb", "#ffb6c1", "#ff69b4", "#ff1493", "#db7093", "#c71585", "#ff85b2", "#ffa6c9"];
    const angleStep = 360 / prizes.length;
    let spinCount = parseInt(localStorage.getItem('spinCount') || '0');
    let bonusSpins = parseInt(localStorage.getItem('bonusSpins') || '2');
    let balance = parseFloat(localStorage.getItem('balance') || '0');
    let referrals = JSON.parse(localStorage.getItem('referrals') || '[]');

    const wheel = document.getElementById("wheel");
    const ctx = wheel.getContext("2d");

    function drawWheel() {
      ctx.clearRect(0, 0, 300, 300);
      for (let i = 0; i < prizes.length; i++) {
        const startAngle = i * 2 * Math.PI / prizes.length;
        const endAngle = (i + 1) * 2 * Math.PI / prizes.length;
        ctx.beginPath();
        ctx.moveTo(150, 150);
        ctx.fillStyle = colors[i % colors.length];
        ctx.arc(150, 150, 150, startAngle, endAngle);
        ctx.fill();

        ctx.save();
        ctx.translate(150, 150);
        ctx.rotate(startAngle + angleStep * Math.PI / 360);
        ctx.fillStyle = "#000";
        ctx.textAlign = "right";
        ctx.font = "bold 12px Arial";
        ctx.fillText("\u015eansl\u0131 \u00e7arx", 140, 5);
        ctx.restore();
      }
    }

    function createLights() {
      const container = document.getElementById("lights");
      for (let i = 0; i < 16; i++) {
        const light = document.createElement("div");
        light.classList.add("light");
        const angle = i * (360 / 16);
        const x = 150 + 140 * Math.cos(angle * Math.PI / 180) - 5;
        const y = 150 + 140 * Math.sin(angle * Math.PI / 180) - 5;
        light.style.left = `${x}px`;
        light.style.top = `${y}px`;
        container.appendChild(light);
      }
    }

    function spinHandler() {
      if (bonusSpins > 0) {
        bonusSpins--;
        localStorage.setItem('bonusSpins', bonusSpins);
        updateUI();
        spin();
      } else {
        show_9532911().then(() => spin());
      }
    }

    function spin() {
      const randomAngle = Math.floor(Math.random() * 360);
      const totalRotation = 5 * 360 + randomAngle;
      wheel.style.transition = "transform 4s ease-out";
      wheel.style.transform = `rotate(${totalRotation}deg)`;

      setTimeout(() => {
        const finalAngle = (360 - (totalRotation % 360)) % 360;
        const index = Math.floor((finalAngle + angleStep / 2) % 360 / angleStep);
        const prize = prizes[index];
        balance += prize;
        spinCount++;
        localStorage.setItem('spinCount', spinCount);
        localStorage.setItem('balance', balance);
        updateUI();
        showPopup(`${prize.toFixed(3)} AZN qazand\u0131n!`);
      }, 4000);
    }

    function showPopup(text) {
      const popup = document.getElementById("popup");
      popup.innerText = text;
      popup.style.display = "block";
      setTimeout(() => popup.style.display = "none", 3000);
    }

    function updateUI() {
      document.getElementById("spinCounter").innerText = `${spinCount}/50`;
      document.getElementById("bonusCount").innerText = bonusSpins;
    }

    function showBalance() {
      alert(`Balans: ${balance.toFixed(2)} AZN`);
    }

    function showInvitePopup() {
      const tg = window.Telegram?.WebApp?.initDataUnsafe?.user || { id: '123456', username: 'namelum' };
      const link = `https://t.me/adsOFmanat_bot?start=${tg.id}`;
      const list = referrals.map((u, i) => `${i + 1}. ${u}`).join("\n") || "He\u00e7 kim d\u0259v\u0259t edilm\u0259yib.";
      const html = `<p>H\u0259r d\u0259v\u0259t etdiyin dosta 2 spin qazanacaqsan!</p>
        <p><b>D\u0259v\u0259t linkin:</b><br><button class='btn' onclick='copyLink()'>${link}</button></p>
        <p><b>D\u0259v\u0259t etdiklərin:</b><br><pre>${list}</pre></p><button class='btn' onclick='closeInvitePopup()'>Ba\u011fla</button>`;
  const invitePopup = document.getElementById("invitePopup");
  invitePopup.innerHTML = html;
  invitePopup.style.display = "block";
}

function closeInvitePopup() {
  document.getElementById("invitePopup").style.display = "none";
}

function copyLink() {
  const tg = window.Telegram?.WebApp?.initDataUnsafe?.user || { id: '123456' };
  const link = `https://t.me/adsOFmanat_bot?start=${tg.id}`;
  navigator.clipboard.writeText(link);
  showPopup("Link kopyaland\u0131!");
}

// Referral check (simulate for now)
const urlParams = new URLSearchParams(window.location.search);
const ref = urlParams.get('start');
const myId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
if (ref && ref !== myId) {
  const refKey = `bonusFrom_${ref}`;
  if (!localStorage.getItem(refKey)) {
    fetch(`https://api.telegram.org/bot8133472449:AAHtl4g78JW2Jx5uw3Pxgn5TCXdVQTO9lMI/sendMessage?chat_id=${ref}&text=\u2b50 Yeni istifad\u0259\u00e7i sizi d\u0259v\u0259t etdi! Siz\u0259 2 spin verildi!`);
    localStorage.setItem(refKey, 'given');
    // Backend'de link sahibine 2 spin art\u0131r\u0131lmal\u0131d\u0131r
  }
}

drawWheel();
createLights();
updateUI();

  </script>
</body>
</html>
